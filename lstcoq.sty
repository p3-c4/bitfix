\RequirePackage[final]{listings}
\RequirePackage{xcolor}

\definecolor{darkblue}{rgb}{0.0, 0.0, 0.55}
\definecolor{darkgreen}{rgb}{0.0, 0.55, 0.13}
\definecolor{darkred}{rgb}{0.55, 0.0, 0.0}
\definecolor{darkviolet}{rgb}{0.58, 0.0, 0.83}
\definecolor{lightblue}{rgb}{0.68, 0.85, 0.9}

%=======================================================================
% Définit le style ssr Gallina pour les listings (Assia Mahboubi 2007)
\lstdefinelanguage{Coq}{ 
%
% Anything betweeen $ becomes LaTeX math mode
mathescape=true,
%
% Comments may or not include Latex commands
texcl=false,
% Marker for file inclusion
rangeprefix=\(\*\ \=,
rangesuffix=\=\ \*\),
includerangemarker=false,
%
%
% Vernacular commands
morekeywords=[1]{
Section, Module, End, Require, Import, Export,
Variable, Variables, Parameter, Parameters, Axiom, Hypothesis, Hypotheses,
Notation, Local, Tactic, Reserved, Scope, Open, Close, Bind, Delimit,
Definition, Let, Ltac, Fixpoint, CoFixpoint, Add, Morphism, Relation,
Implicit, Arguments, Unset, Contextual, Strict, Prenex, Implicits,
Inductive, CoInductive, Record, Structure, Canonical, Coercion,
Context, Class, Global, Instance, Program, Infix,
Theorem, Lemma, Corollary, Proposition, Fact, Remark, Example,
Proof, Goal, Save, Qed, Defined, Hint, Resolve, Rewrite, View,
Search, Show, Print, Printing, All, Graph, Projections, inside, outside},
%
% Gallina
morekeywords=[2]{forall, exists, exists2, fun, fix, cofix, struct,
      match, with, end, as, in, return, let, if, is, then, else,
      for, of, nosimpl, when},
%
% Sorts
morekeywords=[3]{Type, Prop},
%
% Various tactics, some are std Coq subsumed by ssr, for the manual purpose
morekeywords=[4]{
         pose, set, move, case, elim, apply, clear,
            hnf, intro, intros, generalize, rename, pattern, after,
destruct, induction, using, refine, inversion, injection,
         rewrite, congr, unlock, compute, ring, field, fourier,
            replace, fold, unfold, change, cutrewrite, simpl,
         have, suff, wlog, suffices, without, loss, nat_norm,
            assert, cut, trivial, revert, bool_congr, nat_congr,
 symmetry, transitivity, auto, split, autorewrite},
% symmetry, transitivity, auto, split, left, right, autorewrite},
%
% Terminators
morekeywords=[5]{
         by, done, exact, reflexivity, tauto, romega, omega,
         assumption, solve, contradiction, discriminate},
%
% Control
morekeywords=[6]{do, last, first, try, idtac, repeat, compute},
%
% Various symbols
% For the ssr manual we turn off the prettyprint of formulas
% literate=
% {->}{{$\rightarrow\,$}}2
% {->}{{\tt ->}}3
% {<-}{{$\leftarrow\,$}}2
% {<-}{{\tt <-}}2
% {>->}{{$\mapsto$}}3
% {<=}{{$\leq$}}1
% {>=}{{$\geq$}}1
% {<>}{{$\neq$}}1
% {/\\}{{$\wedge$}}2
% {\\/}{{$\vee$}}2
% {<->}{{$\leftrightarrow\;$}}3
% {<=>}{{$\Leftrightarrow\;$}}3
% {:nat}{{$~\in\mathbb{N}$}}3
% {fforall\ }{{$\forall_f\,$}}1
% {forall\ }{{$\forall\,$}}1
% {exists\ }{{$\exists\,$}}1
% {negb}{{$\neg$}}1
% {spp}{{:*:\,}}1
% {~}{{$\sim$}}1
% {\\in}{{$\in\;$}}1
% {/\\}{$\land\,$}1
% {:*:}{{$*$}}2
% {=>}{{$\,\Rightarrow\ $}}1
% {=>}{{\tt =>}}2
% {:=}{{{\tt:=}\,\,}}2
% {==}{{$\equiv$}\,}2
% {!=}{{$\neq$}\,}2
% {^-1}{{$^{-1}$}}1
% {elt'}{elt'}1
% {=}{{\tt=}\,\,}2
% {+}{{\tt+}\,\,}2,
%
% Comments delimiters, we do turn this off for the manual
morecomment=[s]{(**}{**)},
morecomment=[s]{(*}{*)},
%
% Spaces are not displayed as a special character
showstringspaces=false,
%
% String delimiters
morestring=[b]",
morestring=[d],
%
% Size of tabulations
tabsize=3,
%
% Enables ASCII chars 128 to 255
extendedchars=true,
%
% Case sensitivity
sensitive=true,
%
% Automatic breaking of long lines
breaklines=true,
%
% Default style fors listings
basicstyle=\normalsize,
%
% Position of captions is bottom
captionpos=b,
%
% Full flexible columns
columns=[l]fullflexible,
keepspaces=true,
%
% Style for (listings') identifiers
identifierstyle={\ttfamily\color{black}},
% Note : highlighting of Coq identifiers is done through a new
% delimiter definition through an lstset at the begining of the
% document. Don't know how to do better.
%
% Style for declaration keywords
keywordstyle=[1]{\ttfamily\color{darkviolet}},
% Style for gallina keywords
keywordstyle=[2]{\ttfamily\color{darkgreen}},
% Style for sorts keywords
keywordstyle=[3]{\ttfamily\color{darkblue}},
% Style for tactics keywords
keywordstyle=[4]{\ttfamily\color{darkblue}},
% Style for terminators keywords
keywordstyle=[5]{\ttfamily\color{darkred}},
%Style for iterators
%keywordstyle=[6]{\ttfamily\color{dkpink}},
% Style for strings
stringstyle=\ttfamily,
% Style for comments
commentstyle={\ttfamily\color{darkred} \small},
%
%
moredelim=**[is][\ttfamily\color{red}]{/&}{&/},
%litterate
literate=
    {\\/}{{$\vee$}}2
    {\\equiv}{{$\leftrightarrow\,$}}3
    {==>}{{$\Rightarrow$}}1 
    {-->}{{{\color{blue}$\longrightarrow$}}}1 
    {b_to_c}{f$_{bc}$}1 
    {c_to_b}{{f$_{cb}$}}1 
    {c_to_a}{{f$_{ca}$}}1 
    {prop_b}{{P$_{b}$}}1 
    {prop_c}{{P$_{c}$}}1 
    {is_equiv_b_to_c}{{is\_equiv$_{\text{f}_{bc}}$}}1
    {prop_c_to_a}{{P$_{\text{f}_{ca}}$}}1 
    {dp_a}{{dec$_{A}$}}1 
    {dp_b}{{dec$_{B}$}}1
    {dp_c}{{dec$_{C}$}}1
    {hp_p}{{hpr$_{P}$}}1
    {spl_to_idx}{{f$_{si}$}}1
    {idx_to_spl}{{f$_{is}$}}1
    {check_p}{{check$_P$}}1 
    {=>}{{$\Rightarrow$}}1
    {>->}{{$\rightarrowtail$}}2
    {->}{{$\rightarrow\,$}}2
    {->>}{{{\color{purple}$\rightharpoonup\,$}}}2
    {⇀}{{{\color{purple}$\rightharpoonup\,$}}}2
    {<-}{{$\leftarrow\,$}}2
    {:>}{{$: >$}}2
    {prod}{{$\times$}}2
    {product}{\texttt{product}}1
    % {*}{{$\times$}}1
    {++}{{$\cup$}}1
    {<==}{{$\subseteq$}}1
    {<=}{{$\leq$}}1
    {|-}{{\quad$\vdash$\quad}}1
    {forall}{{$\forall$}}1
    {exists}{{$\exists$}}1
    {=o=}{{$\circeq$}}1
    {\\fun}{{$\lambda$}}1
    {|>}{{$\rhd$}}1
    {\\oplus}{{$\oplus$}}1
    {\\tab}{{\quad}}1
    {\\_}{{ }}1
    {||}{{$\vee$}}1
    {\&\&}{{$\wedge$}}1
    {\\data}{{$\mathbb{T}$}}1
    {\\times}{{$\times$}}1
    {\\xorb}{{$\oplus$}}1
    {\\andb}{{$\wedge$}}1
    {λ}{{$\lambda$}}1
    {^-1}{{$^{\mbox{-} 1}$}}1
    {≼}{{$\preceq$}}1
    {relS}{{$\preceq$}}1
    {°}{{$\circ$}}1
    {α}{$\alpha$}1
    {comp}{{$\circ$}}1
    {°°}{{$\circ_K$}}1
    {compk}{{$\circ_K$}}1
    {compute}{{compute}}1
    {°V}{{$\circ_V$}}1
    {compV}{{$\circ_V$}}1
    {°H}{{$\circ_H$}}1
    {compH}{{$\circ_H$}}1
    {assoc}{{$\alpha$}}1
    {associated}{{$\mathtt{associated}$}}1
    {_pp}{{$_\bot$}}1
    {projT1}{{$\pi_1$}}1
    {assocK}{{$\alpha$}}1
    {≃}{{$\Equiv$}}1
    {≲}{{{\color{blue}$\Connection$}}}1
    {≈}{{{\color{blue}$\AntiConnection$}}}1
    {≲K}{{{\color{purple}$\PartialConnection$}}}1
    {≈K}{{{\color{purple}$\AntiPartialConnection$}}}1
    {≲K□}{{{\color{purple}$\DependentConnection$}}}2
    {≈K□}{{{\color{purple}$\AntiDependentConnection$}}}2
    {apK}{{$\mathtt{ap}_K$}}1
    {1}{{$\mathtt{1}$}}1
    {2}{{$\mathtt{2}$}}1
    {3}{{$\mathtt{3}$}}1
    {4}{{$\mathtt{4}$}}1
    {5}{{$\mathtt{5}$}}1
    {6}{{$\mathtt{6}$}}1
    {7}{{$\mathtt{7}$}}1
    {8}{{$\mathtt{8}$}}1
    {9}{{$\mathtt{9}$}}1
    {π1}{{$\pi_1$}}1
    {π2}{{$\pi_2$}}1
    {_1}{{$_1$}}1
    {_2}{{$_2$}}1
    {_3}{{$_3$}}1
    {NList}{{$\mathtt{List}_\mathbb{N}$}}1
    {NVec}{{$\mathtt{Vec}_\mathbb{N}$}}1
%   Cheats:
    {Hdstack}{{\texttt{dstack}}}6
    {Hdinstr}{{\texttt{dinstr}}}6
    {Hstack}{{\texttt{stack}}}5
    {Hinstr}{{\texttt{instr}}}5
    {HlistZ}{{\texttt{listZ}}}5
    {vector}{{\texttt{Vec}}}3
    {HOConnectionAnti}{{\texttt{HOConnection}}}3
    {ac_fun}{{\texttt{c\_fun}}}3
    {ac_inv}{{\texttt{c\_inv}}}3
    {ac_isconn}{{\texttt{c\_isconn}}}3
%
}[keywords,strings]


%% \ifcoqcheck
%% \lstnewenvironment{coq}{\lstset{language=Coq,frame=TBLR}}{}
%% \else
\lstnewenvironment{coq}{\lstset{language=Coq}}{}
%% \fi

% pour inliner dans le texte
\def\coqinline{\lstinline[language=Coq, basicstyle=\normalsize]}
% pour inliner dans les tableaux / displaymath...
\def\coqinlines{\lstinline[language=Coq]}
\def\coqe{\lstinline[language=Coq, basicstyle=\normalsize,escapechar=*]}

\newcommand{\coqfrom}[2]
           {%\ifcoqcheck
             %\lstinputlisting[frame=single,language=Coq,linerange={#2}-end]{../../code/#1.v}
             %\else
             \lstinputlisting[language=Coq,linerange={#2}-end]{./theories/#1.v}}
             %\fi}

%% \lstnewenvironment
%%     {altcoqfrom}[2]
%%     {%\ifcoqcheck
%%      % \TODO{Origin:}
%%       \coqfrom{#1}{#2}
%%      % \TODO{Check alternative:}
%%      % \fi
%%       \lstset{language=Coq}}
%%     {}
